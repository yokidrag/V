<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>V</title>
  <style>
    *{box-sizing:border-box}
    
    :root{
      --bg-1: #061227;
      --bg-2: #0b2340;
      --dialog-bg: rgba(11, 23, 45, 0.95);
      --accent: #2b6df6;
      --text: rgba(230,238,251,0.95);
      --text-muted: rgba(230,238,251,0.7);
    }

    html, body{
      margin:0;
      padding:0;
      height:100%;
      font-family: Inter, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg-1), var(--bg-2));
      color: var(--text);
      overflow: hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    #gameContainer{
      width:100vw;
      height:100vh;
      display:flex;
      flex-direction:column;
      position:relative;
    }

    /* –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å ‚Äî —Ñ–æ–Ω */
    #backgroundArea{
      flex:1;
      background: linear-gradient(180deg, var(--bg-1), var(--bg-2));
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
      color:var(--text-muted);
      font-size:14px;
    }

    #backgroundArea img,
    #backgroundArea video {
      max-width: 90%;
      max-height: 90%;
      object-fit: contain;
      border-radius: 8px;
      border: 1px solid rgba(43, 109, 246, 0.4);
      padding: 2px;
      box-shadow: 0 0 20px rgba(43, 109, 246, 0.15);
    }

    /* –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å ‚Äî –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ */
    #dialogContainer{
      position:relative;
      height:160px;
      padding:16px 24px;
      background: var(--dialog-bg);
      border-top: 1px solid rgba(255,255,255,0.1);
      display:flex;
      flex-direction:column;
      justify-content:flex-start;
      gap:8px;
    }

    /* –ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ */
    #characterName{
      font-size:14px;
      font-weight:600;
      color:var(--accent);
      text-transform:uppercase;
      letter-spacing:0.5px;
      margin-bottom:8px;
      height:16px;
      line-height:16px;
    }

    /* –¢–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞ */
    #dialogText{
      font-size:16px;
      line-height:1.5;
      color:var(--text);
      word-wrap:break-word;
      white-space:pre-wrap;
      position:relative;
    }

    /* –ë–µ–ª—ã–π —Ä–æ–º–± (–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å) */
    .continuation-diamond{
      display:inline;
      color:#fff;
      animation:blink 0.8s infinite;
    }

    @keyframes blink{
      0%, 49%{opacity:1}
      50%, 100%{opacity:0.3}
    }

    /* –ë–ª–æ–∫ —Å –≤—ã–±–æ—Ä–∞–º–∏ (—Å–ø—Ä–∞–≤–∞) */
    #choicesContainer{
      position:fixed;
      right:40px;
      top:50%;
      transform:translateY(-50%);
      display:flex;
      flex-direction:column;
      gap:12px;
      max-width:280px;
      z-index:100;
    }

    .choice-button{
      background:rgba(43, 109, 246, 0.1);
      border:1px solid rgba(43, 109, 246, 0.4);
      color:var(--text);
      padding:12px 16px;
      font-size:14px;
      border-radius:6px;
      cursor:pointer;
      transition:all 0.2s ease;
      text-align:left;
      line-height:1.4;
      max-width:280px;
      word-wrap:break-word;
    }

    .choice-button:hover{
      background:rgba(43, 109, 246, 0.3);
      border-color:var(--accent);
      color:#e6eefb;
      transform:translateX(-4px);
    }

    .choice-button:active{
      transform:translateX(-2px) scale(0.98);
    }

    /* –ö–ª–∏–∫ –Ω–∞ –¥–∏–∞–ª–æ–≥ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è */
    #dialogContainer.clickable{
      cursor:pointer;
    }

    #dialogContainer.clickable:hover{
      background: rgba(11, 23, 45, 0.98);
    }

    /* –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã */
    .hidden{
      display:none !important;
    }

    /* === –°–¢–ò–õ–ò –î–õ–Ø –°–ò–°–¢–ï–ú–ù–û–ô –û–®–ò–ë–ö–ò === */
    #errorOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      z-index: 10000;
      display: none;
      align-items: flex-start;
      justify-content: flex-start;
      padding: 40px;
    }

    #errorOverlay.active {
      display: flex;
    }

    #terminal {
      background: transparent;
      padding: 0;
      max-width: 90%;
      max-height: none;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: #00ff00;
      overflow-y: visible;
      line-height: 1.8;
      word-break: break-all;
      white-space: pre-wrap;
    }

    .terminal-line {
      display: block;
      min-height: 20px;
      margin: 2px 0;
    }

    .terminal-cursor {
      display: inline-block;
      width: 8px;
      height: 12px;
      background: #00ff00;
      margin-left: 4px;
      animation: terminalBlink 0.7s infinite;
    }

    .terminal-cursor.done {
      animation: none;
      opacity: 0;
    }

    @keyframes terminalBlink {
      0%, 49% { opacity: 1; }
      50%, 100% { opacity: 0; }
    }

    #errorMessage {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(11, 23, 45, 0.95);
      border: 1px solid rgba(43, 109, 246, 0.4);
      border-radius: 8px;
      padding: 32px;
      max-width: 400px;
      text-align: center;
      color: var(--text);
      z-index: 10001;
      display: none;
      font-size: 16px;
      line-height: 1.6;
      box-shadow: 0 0 30px rgba(43, 109, 246, 0.2);
    }

    #errorMessage.show {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    #blackScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      z-index: 10002;
      display: none;
    }

    #blackScreen.active {
      display: block;
    }

    #loadingIndicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 14px;
      color: var(--text-muted);
      z-index: 50;
      font-family: 'Courier New', monospace;
      display: none;
    }

    #loadingIndicator.show {
      display: block;
    }
  </style>
</head>
<body>

  <div id="gameContainer">
    <div id="backgroundArea">
      <!-- —Ñ–æ–Ω —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º/–≤–∏–¥–µ–æ -->
    </div>
    <div id="dialogContainer">
      <div id="characterName"></div>
      <div id="dialogText"></div>
    </div>
  </div>

  <div id="choicesContainer"></div>

  <!-- –≠–∫—Ä–∞–Ω —Å–∏—Å—Ç–µ–º–Ω–æ–π –æ—à–∏–±–∫–∏ -->
  <div id="errorOverlay">
    <div id="terminal"></div>
    <div id="errorMessage"></div>
  </div>
  <div id="blackScreen"></div>

  <!-- Loading –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä -->
  <div id="loadingIndicator"></div>

  <script>
    (function(){
      // === –ö–û–ù–§–ò–ì –°–¶–ï–ù ===
      const scenes = [
        {
          id: 0,
          character: '–°–∏—Å—Ç–µ–º–∞',
          text: '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ö–æ–¥–∏—Ç—å –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ.\n–î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–∂–º–∏—Ç–µ –∫–ª–∞–≤–∏—à—É F11.',
          choices: [],
          background: null,
          next: 1
        },
        {
          id: 1,
          character: '–†—É—Å—Ç–∞–º',
          text: '–∞–º–º..\n–≠–ª—è—á–∫–∞, —É –º–µ–Ω—è –∫ —Ç–µ–±–µ –≤–æ–ø—Ä–æ—Å üëâüëà',
          choices: [
            { text: '—ç—ä?', next: 2 }
          ],
          background: 'Source/chibidoki.mp4',
          imageSize: { width: '380px' }
        },
        {
          id: 2,
          character: '–†—É—Å—Ç–∞–º',
          text: '–ë—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?',
          choices: [
            { text: '–î–ê! –ö–û–ù–ï–ß–ù–û!', next: 3 },
            { text: '–Ω—é –Ω–µ–µ–µ', next: 'error' }
          ],
          background: 'Source/ENA/ENA2.webm',
          imageSize: { width: '380px' }
        },
        {
          id: 3,
          character: '–†—É—Å—Ç–∞–º',
          text: '–ô–ê–ê–ê–ê–ê –°–ü–ê–°–ò–ë–û –ß–¢–û –¢–´ –ï–°–¢–¨ –£ –ú–ï–ù–Ø <3',
          choices: [],
          background: 'Source/ENA/ENA HE.mp4',
          loop: false,
          imageSize: { width: '380px' }
        },
        {
          id: 4,
          character: '–†—É—Å—Ç–∞–º',
          text: '–ë—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?',
          choices: [
            { text: '–î–ê! –ö–û–ù–ï–ß–ù–û!', next: 3 },
            { text: '–Ω—é –Ω–µ–µ–µ', next: 'error' }
          ],
          background: 'Source/ENA/ENA2.webm',
          imageSize: { width: '380px' },
          skipLoading: true
        },
        {
          id: 5,
          character: '–†—É—Å—Ç–∞–º',
          text: '–ë—É–¥–µ—à—å –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π?',
          choices: [
            { text: '–î–ê! –ö–û–ù–ï–ß–ù–û!', next: 3 }
          ],
          background: 'Source/ENA/ENA2.webm',
          imageSize: { width: '380px' },
          skipLoading: true
        }
      ];

      let currentSceneIndex = 0;
      let isTextShowing = false;
      let textCompleted = false;
      let previousSceneIndex = 0;
      let scene2FirstVisit = true;
      let loadingInterval = null;

      const gameContainer = document.getElementById('gameContainer');
      const backgroundArea = document.getElementById('backgroundArea');
      const dialogContainer = document.getElementById('dialogContainer');
      const characterNameEl = document.getElementById('characterName');
      const dialogTextEl = document.getElementById('dialogText');
      const choicesContainer = document.getElementById('choicesContainer');
      const errorOverlay = document.getElementById('errorOverlay');
      const terminal = document.getElementById('terminal');
      const errorMessage = document.getElementById('errorMessage');
      const blackScreen = document.getElementById('blackScreen');
      const loadingIndicator = document.getElementById('loadingIndicator');

      // === –§–£–ù–ö–¶–ò–ò ===

      // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ–Ω
      function clearBackground() {
        backgroundArea.innerHTML = '';
      }

      // –í—ã—Å—Ç–∞–≤–∏—Ç—å —Ñ–æ–Ω
      function setBackground(backgroundPath, shouldLoop = true, imageSize = {}) {
        clearBackground();
        if (!backgroundPath) return;

        if (backgroundPath.endsWith('.mp4') || backgroundPath.endsWith('.webm')) {
          const video = document.createElement('video');
          video.src = backgroundPath;
          video.autoplay = true;
          video.loop = shouldLoop;
          video.muted = true;
          video.playsInline = true;
          if (imageSize.width) video.style.width = imageSize.width;
          if (imageSize.height) video.style.height = imageSize.height;
          backgroundArea.appendChild(video);
        } else {
          const img = document.createElement('img');
          img.src = backgroundPath;
          if (imageSize.width) img.style.width = imageSize.width;
          if (imageSize.height) img.style.height = imageSize.height;
          backgroundArea.appendChild(img);
        }
      }

      // –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏
      function typeText(text, speed = 30) {
        return new Promise((resolve) => {
          let index = 0;
          dialogTextEl.textContent = '';
          isTextShowing = true;
          textCompleted = false;

          function type() {
            if (index < text.length) {
              dialogTextEl.textContent += text[index];
              index++;
              setTimeout(type, speed);
            } else {
              isTextShowing = false;
              textCompleted = true;
              // –î–æ–±–∞–≤–ª—è–µ–º —Ä–æ–º–± –ø—Ä—è–º–æ –≤ –∫–æ–Ω–µ—Ü —Ç–µ–∫—Å—Ç–∞
              const diamond = document.createElement('span');
              diamond.className = 'continuation-diamond';
              diamond.textContent = ' ‚óÜ';
              dialogTextEl.appendChild(diamond);
              resolve();
            }
          }

          type();
        });
      }

      // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø LOADING –ò–ù–î–ò–ö–ê–¢–û–†–ê ===

      function startLoadingAnimation() {
        loadingIndicator.classList.add('show');
        const states = ['loading', 'loading.', 'loading..', 'loading...', 'loading..', 'loading.'];
        let stateIndex = 0;

        loadingInterval = setInterval(() => {
          loadingIndicator.textContent = states[stateIndex];
          stateIndex = (stateIndex + 1) % states.length;
        }, 1000);
      }

      function stopLoadingAnimation() {
        if (loadingInterval) {
          clearInterval(loadingInterval);
          loadingInterval = null;
        }
        loadingIndicator.classList.remove('show');
      }

      // === –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–ò–°–¢–ï–ú–ù–û–ô –û–®–ò–ë–ö–ò ===

      function generateGarbledText() {
        const chars = '%$#@!_??~^&*()[]{}|-\\:;";\'<>,.?/';
        let result = '';
        for (let i = 0; i < 15; i++) {
          result += chars[Math.floor(Math.random() * chars.length)];
        }
        return result;
      }

      function addTerminalLine(text, delay = 0, isGarbled = false) {
        return new Promise((resolve) => {
          setTimeout(() => {
            const line = document.createElement('span');
            line.className = 'terminal-line' + (isGarbled ? ' garbled' : '');
            line.textContent = text;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            resolve();
          }, delay);
        });
      }

      // –ü–µ—á–∞—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ —Å –º–∏–≥–∞—é—â–∏–º –∫—É—Ä—Å–æ—Ä–æ–º
      async function typeTerminalLine(text, pauseAfter = 0, textColor = '#00ff00', redStartIndex = -1) {
        const line = document.createElement('div');
        line.className = 'terminal-line';

        const prompt = document.createElement('span');
        prompt.style.color = '#00ff00';
        prompt.style.fontWeight = 'bold';
        prompt.textContent = '‚Äî ';
        line.appendChild(prompt);

        const textSpan = document.createElement('span');
        line.appendChild(textSpan);

        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–∞–∑–Ω–æ—Ü–≤–µ—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        let currentColor = textColor;
        let currentSpan = document.createElement('span');
        currentSpan.style.color = currentColor;
        textSpan.appendChild(currentSpan);

        const cursor = document.createElement('span');
        cursor.className = 'terminal-cursor';
        line.appendChild(cursor);

        terminal.appendChild(line);
        terminal.scrollTop = terminal.scrollHeight;

        // –ü–µ—á–∞—Ç—å —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–∏–º–≤–æ–ª–∞–º —Å –º–∏–≥–∞—é—â–∏–º –∫—É—Ä—Å–æ—Ä–æ–º
        for (let i = 0; i < text.length; i++) {
          // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –ø–æ–∑–∏—Ü–∏–∏, –≥–¥–µ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç
          if (i === redStartIndex && redStartIndex >= 0) {
            currentColor = '#ff0000';
            currentSpan = document.createElement('span');
            currentSpan.style.color = currentColor;
            textSpan.appendChild(currentSpan);
          }

          currentSpan.textContent += text[i];
          await new Promise(resolve => setTimeout(resolve, 15));
        }

        // –£–¥–∞–ª—è–µ–º –º–∏–≥–∞–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞ –ø–æ—Å–ª–µ –ø–µ—á–∞—Ç–∏
        cursor.classList.add('done');

        // –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–∞—É–∑–∞ –ø–æ—Å–ª–µ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏
        if (pauseAfter > 0) {
          await new Promise(resolve => setTimeout(resolve, pauseAfter));
        }

        return new Promise(resolve => setTimeout(resolve, 100));
      }

      async function showSystemError(errorType = 1) {
        // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å—Ü–µ–Ω—É, –≥–¥–µ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
        const errorSceneIndex = currentSceneIndex;

        // –°–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        gameContainer.style.display = 'none';
        choicesContainer.style.display = 'none';

        if (errorType === 1) {
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—ë—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω –ø–µ—Ä–µ–¥ –æ—à–∏–±–∫–æ–π
          blackScreen.classList.add('active');
          await new Promise(resolve => setTimeout(resolve, 3000));
          blackScreen.classList.remove('active');

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –æ—à–∏–±–∫–∏ —Å –Ω–æ–≤–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
          errorOverlay.classList.add('active');
          terminal.innerHTML = '';
          errorMessage.textContent = '';
          errorMessage.classList.remove('show');

          // –ù–æ–≤–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
          const terminalLines = [
            { text: '–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è...', pause: 1000, color: '#00ff00', redStartIndex: -1 },
            { text: '–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è...', pause: 1000, color: '#00ff00', redStartIndex: -1 },
            { text: '—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–π —Ç–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è...', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: '–æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –æ–∂–∏–¥–∞–µ–º–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: '–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è...', pause: 2000, color: '#00ff00', redStartIndex: -1 },
            { text: '—Å—Ç–∞—Ç—É—Å: %$#@ERROR#%', pause: 0, color: '#00ff00', redStartIndex: 8 },
            { text: '–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞ –¥–∏–∞–ª–æ–≥–∞', pause: 0, color: '#00ff00', redStartIndex: 16 },
            { text: '–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è...', pause: 2000, color: '#00ff00', redStartIndex: -1 },
            { text: '–ø–æ–∏—Å–∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ç–æ—á–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è...', pause: 1000, color: '#00ff00', redStartIndex: -1 }
          ];

          // –ü–µ—á–∞—Ç–∞–µ–º –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
          for (const line of terminalLines) {
            await typeTerminalLine(line.text, line.pause, line.color, line.redStartIndex);
          }

          // –ö—Ä–∞—Ç–∫–∞—è –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ —á—ë—Ä–Ω—ã–º —ç–∫—Ä–∞–Ω–æ–º
          await new Promise(resolve => setTimeout(resolve, 300));

          // –°–∫—Ä—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —á—ë—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã
          errorOverlay.classList.remove('active');
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º gameContainer —Å —á—ë—Ä–Ω—ã–º —Ñ–æ–Ω–æ–º –∏ –¥–∏–∞–ª–æ–≥–æ–º –≤–Ω–∏–∑—É (–∫–∞–∫ –≤ –Ω–æ–≤–µ–ª–ª–µ)
          gameContainer.style.display = 'flex';
          backgroundArea.style.background = '#000';
          backgroundArea.innerHTML = '';
          choicesContainer.style.display = 'none';
          loadingIndicator.classList.remove('show');
          loadingIndicator.textContent = '';

          characterNameEl.textContent = '–°–ò–°–¢–ï–ú–ê';
          
          // –ò—Å–ø–æ–ª—å–∑—É–µ–º gradual typing —ç—Ñ—Ñ–µ–∫—Ç –∫–∞–∫ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –Ω–æ–≤–µ–ª–ª–µ
          await typeText('–£–ø—Å. –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞.\n–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è...');

          // –î–µ–ª–∞–µ–º –¥–∏–∞–ª–æ–≥ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º
          dialogContainer.style.cursor = 'pointer';

          // –ñ–¥—ë–º –∫–ª–∏–∫–∞ –ø–æ –¥–∏–∞–ª–æ–≥—É
          dialogContainer.addEventListener('click', async function onClick() {
            dialogContainer.removeEventListener('click', onClick);
            characterNameEl.textContent = '';
            dialogTextEl.innerHTML = '';
            gameContainer.style.display = 'none';
            backgroundArea.style.background = '';
            loadingIndicator.classList.remove('show');
            loadingIndicator.textContent = '';
            blackScreen.classList.add('active');
            // –ß—ë—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω –µ—â—ë 2 —Å–µ–∫—É–Ω–¥—ã
            await new Promise(resolve => setTimeout(resolve, 2000));
            blackScreen.classList.remove('active');
            gameContainer.style.display = 'flex';
            choicesContainer.style.display = 'flex';
            scene2FirstVisit = true;
            renderScene(4);
          });

        } else if (errorType === 2) {
          // –û—à–∏–±–∫–∞ 2: —á—ë—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω, —Ç–µ—Ä–º–∏–Ω–∞–ª —Å –Ω–æ–≤–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é, –¥–∏–∞–ª–æ–≥, —Ç–µ–º —Å—Ü–µ–Ω–∞ 5
          blackScreen.classList.add('active');
          await new Promise(resolve => setTimeout(resolve, 3000));
          blackScreen.classList.remove('active');

          errorOverlay.classList.add('active');
          errorOverlay.style.backgroundImage = 'url(Source/Monika/Monika%20dark.jpg)';
          errorOverlay.style.backgroundSize = 'cover';
          errorOverlay.style.backgroundPosition = 'center';
          errorOverlay.style.backgroundRepeat = 'no-repeat';
          errorOverlay.style.backgroundAttachment = 'fixed';
          terminal.innerHTML = '';

          // –ù–æ–≤–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ –¥–ª—è –æ—à–∏–±–∫–∏ 2
          const terminalLines2 = [
            { text: '–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è...', pause: 1000, color: '#00ff00', redStartIndex: -1 },
            { text: '–æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: '', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: '–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –æ–±–Ω–∞—Ä—É–∂–µ–Ω –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –æ—Ç–≤–µ—Ç', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: '–æ—Ç–≤–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è', pause: 1000, color: '#00ff00', redStartIndex: -1 },
            { text: '–ø–æ–∏—Å–∫ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤...', pause: 2000, color: '#00ff00', redStartIndex: -1 },
            { text: '', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: '–ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –Ω–∞–±–æ—Ä–∞ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤...', pause: 3000, color: '#00ff00', redStartIndex: -1 },
            { text: '', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: 'response_vector_corrupted', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: 'removing incompatible response...', pause: 0, color: '#00ff00', redStartIndex: -1 },
            { text: 'incompatible response removed', pause: 0, color: '#00ff00', redStartIndex: -1 }
          ];

          for (const line of terminalLines2) {
            if (line.text === '') {
              // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
              const emptyLine = document.createElement('div');
              emptyLine.className = 'terminal-line';
              terminal.appendChild(emptyLine);
              terminal.scrollTop = terminal.scrollHeight;
            } else {
              await typeTerminalLine(line.text, line.pause, line.color, line.redStartIndex);
            }
          }

          // –ö—Ä–∞—Ç–∫–∞—è –ø–∞—É–∑–∞
          await new Promise(resolve => setTimeout(resolve, 300));

          // –°–∫—Ä—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º gameContainer —Å –¥–∏–∞–ª–æ–≥–æ–º
          errorOverlay.classList.remove('active');
          gameContainer.style.display = 'flex';
          backgroundArea.style.background = '#000';
          backgroundArea.innerHTML = '';
          choicesContainer.style.display = 'none';
          loadingIndicator.classList.remove('show');
          loadingIndicator.textContent = '';

          characterNameEl.textContent = '–°–ò–°–¢–ï–ú–ê';
          await typeText('...');

          // –î–µ–ª–∞–µ–º –¥–∏–∞–ª–æ–≥ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º
          dialogContainer.style.cursor = 'pointer';

          // –ñ–¥—ë–º –∫–ª–∏–∫–∞ –ø–æ –¥–∏–∞–ª–æ–≥—É
          dialogContainer.addEventListener('click', async function onClick() {
            dialogContainer.removeEventListener('click', onClick);
            characterNameEl.textContent = '';
            dialogTextEl.innerHTML = '';
            gameContainer.style.display = 'none';
            backgroundArea.style.background = '';
            blackScreen.classList.add('active');
            await new Promise(resolve => setTimeout(resolve, 2000));
            blackScreen.classList.remove('active');
            gameContainer.style.display = 'flex';
            choicesContainer.style.display = 'flex';
            renderScene(5);
          });
        }
      }

      // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ü–µ–Ω—É
      async function renderScene(sceneIndex) {
        const scene = scenes[sceneIndex];
        if (!scene) return;

        // –û—Å—Ç–∞–Ω–æ–≤–∏–º loading –µ—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –¥—Ä—É–≥—É—é —Å—Ü–µ–Ω—É
        if (currentSceneIndex === 2 && sceneIndex !== 2) {
          stopLoadingAnimation();
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ü–µ–Ω—É –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–æ–≤—É—é
        previousSceneIndex = currentSceneIndex;
        currentSceneIndex = sceneIndex;

        // –û—á–∏—â–∞–µ–º –≤—ã–±–æ—Ä—ã
        choicesContainer.innerHTML = '';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        characterNameEl.textContent = scene.character || '';

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ–Ω (loop –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true)
        const shouldLoop = scene.loop !== false;
        const imageSize = scene.imageSize || {};
        setBackground(scene.background, shouldLoop, imageSize);

        // –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏
        await typeText(scene.text);

        // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å—Ü–µ–Ω—ã 2 - loading –∞–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ
        if (sceneIndex === 2 && scene2FirstVisit && !scene.skipLoading) {
          scene2FirstVisit = false;
          startLoadingAnimation();
        }

        // –ï—Å–ª–∏ –≤—ã–±–æ—Ä–æ–≤ –Ω–µ—Ç ‚Äî –∫–ª–∏–∫ –Ω–∞ –¥–∏–∞–ª–æ–≥ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å—Ü–µ–Ω—É
        if (scene.choices.length === 0) {
          dialogContainer.classList.add('clickable');
          dialogContainer.addEventListener('click', handleDialogClick, { once: true });
        } else {
          // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±–æ—Ä—ã ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö
          renderChoices(scene.choices);
        }
      }

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ –¥–∏–∞–ª–æ–≥
      async function handleDialogClick() {
        dialogContainer.classList.remove('clickable');
        if (textCompleted) {
          // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Å—Ü–µ–Ω—ã 5 (—ç–∫—Ä–∞–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã)
          if (currentSceneIndex === 5) {
            gameContainer.style.display = 'none';
            choicesContainer.style.display = 'none';
            blackScreen.classList.add('active');

            // –ß—ë—Ä–Ω—ã–π —ç–∫—Ä–∞–Ω –¥–ª–∏—Ç—Å—è 3 —Å–µ–∫—É–Ω–¥—ã
            await new Promise(resolve => setTimeout(resolve, 3000));

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —Å—Ü–µ–Ω—É 4 (—ç–∫—Ä–∞–Ω 2.1)
            blackScreen.classList.remove('active');
            gameContainer.style.display = 'flex';
            choicesContainer.style.display = 'flex';

            renderScene(4);
          } else {
            const nextScene = scenes[currentSceneIndex].next;
            if (nextScene !== undefined) {
              renderScene(nextScene);
            }
          }
        }
      }

      // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—ã–±–æ—Ä—ã
      function renderChoices(choices) {
        choicesContainer.innerHTML = '';
        choices.forEach((choice, index) => {
          const btn = document.createElement('button');
          btn.className = 'choice-button';
          btn.textContent = choice.text;
          btn.addEventListener('click', () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ —ç—Ç–æ –æ—à–∏–±–∫–∞ –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä
            if (choice.next === 'error') {
                // –†–∞–∑–ª–∏—á–∞–µ–º —Ç–∏–ø –æ—à–∏–±–∫–∏ –ø–æ —Ç–µ–∫—É—â–µ–º—É —ç–∫—Ä–∞–Ω—É
                if (currentSceneIndex === 2) {
                  showSystemError(1);
                } else if (currentSceneIndex === 4) {
                  showSystemError(2);
                } else {
                  showSystemError(1);
                }
            } else if (choice.next !== undefined) {
              renderScene(choice.next);
            }
          });
          choicesContainer.appendChild(btn);
        });
      }

      // –ó–∞–ø—É—Å–∫
      renderScene(currentSceneIndex);
    })();
  </script>

</body>
</html>
